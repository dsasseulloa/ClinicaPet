@model IEnumerable<Projeto.Models.Animal>
@using Projeto.App_Start
@{


    ViewBag.Title = "Index";
}
<head>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    @*<link href="~/DataTables/Bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <link href="~/DataTables/Buttons-1.5.6/css/buttons.bootstrap.min.css" rel="stylesheet" />
        <link href="~/DataTables/DataTables-1.10.18/css/dataTables.bootstrap.css" rel="stylesheet" />
        <link href="~/DataTables/DataTables-1.10.18/css/jquery.dataTables.min.css" rel="stylesheet" />
        <link href="~/DataTables/Editor-2019-09-21-1.9.0/css/editor.bootstrap.min.css" rel="stylesheet" />


        <script src="~/DataTables/jQuery-3.3.1/jquery-3.3.1.min.js"></script>
        <script src="~/DataTables/Bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="~/DataTables/Buttons-1.5.6/js/buttons.bootstrap.min.js"></script>
        <script src="~/DataTables/Buttons-1.5.6/js/dataTables.buttons.min.js"></script>

        <script src="~/DataTables/DataTables-1.10.18/js/dataTables.bootstrap.min.js"></script>
        <script src="~/DataTables/DataTables-1.10.18/js/jquery.dataTables.min.js"></script>

        <script src="~/DataTables/Editor-2019-09-21-1.9.0/js/dataTables.editor.min.js"></script>
        <script src="~/DataTables/Editor-2019-09-21-1.9.0/js/editor.bootstrap.js"></script>*@
    <link href="~/DataTables/datatables.css" rel="stylesheet" />
    <link href="~/admin-lte/css/AdminLTE.min.css" rel="stylesheet" />

    <link href="~/DataTables/DataTables-1.10.18/css/jquery.dataTables.css" rel="stylesheet" />
</head>



<body class="bootstrap">
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">Animais</h3>
                    </div>


                    <div class="row fileupload-buttonbar">
                        <div class="col-lg-8">
                            &nbsp;&nbsp;&nbsp;
                            <a href="@Url.Action("Create", "Animals")" class="btn btn-primary">
                                <i class="glyphicon glyphicon-plus"></i>
                                <span>
                                    <strong>Cadastrar Animal</strong>
                                </span>

                            </a>



                            <a href="@Url.Action("Index", "Clientes")" class="btn btn-success">

                                <span>
                                    <strong>Verificar Clientes</strong>
                                </span>
                            </a>

                        </div>
                    </div>
                    <br>


                    <div class="box-body">
                        <div class="table-responsive">

                            <table id="demoGrid" class="table table-striped table-bordered" style="width:100%">

                                @*<table id="demoGrid" class="table table-bordered table-striped table-hover">*@
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Nome</th>
                                        <th>Nome cliente</th>
                                        <th>Sexo</th>
                                        <th>Tipo</th>
                                        <th>Preço</th>
                                        <th>Pagamento</th>
                                        <th>Data de entrada</th>
                                        <th>Previsão de saída</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                      
                                    </thead>

                            </table>
                        </div>
                    </div>



                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </section>

</body>


@section Scripts{
    <!-- JS -->
    @Scripts.Render("~/bundles/jqueryval")

    <script src="~/DataTables/datatables.min.js"></script>


    <script type="text/javascript">



        /* Formatting function for row details - modify as you need */
        function format(d) {
            // `d` is the original data object for the row
            return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' + 
                '<tr>' +
                '<td>Raça:</td>' +
                '<td>'+ d.Raca + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td>Tipo Sanguíneo:</td>' +
                '<td>' + d.State + '</td>' +
                '</tr>' +
                '<tr>' +
                '<td>Idade:</td>' +
                '<td>' + d.Idade + '</td>' +
                '</tr>' +
                '</table>';
        }


        $(document).ready(function () {
 editor = new $.fn.dataTable.Editor({
                    ajax: "/Animals/Table",
                    table: "#demoGrid",
                    idSrc: 'AnimalID',
                    fields: [
                   {
                            "label": "Status de Pagamento:",
                            "name": "Pagamento",
                            "type": "select",
                            "options": [
                                "Pago",
                                "Pendente"
                            ]
                        }
     ],
     i18n: {
         create: {
             button: "Criar",
             title: "Criar",
             submit: "Criar"
         },
         edit: {
             button: "Editar status de pagamento",
             title: "Modificar status de pagamento",
             submit: "Atualizar"
         },
         remove: {
             button: "Deletar",
             title: "Deletar",
             submit: "Deletar",
             confirm: {
                 _: "Tem certeza que quer deletar estes %d registros?",
                 1: "Tem certeza que quer deletar este registro?"
             }
         }
     }

          
                });

           

           var table =  $("#demoGrid").DataTable({
               dom: 'Bfrtip',

                language: {
                    lengthMenu: "Exibe _MENU_ Registros por página",
                    search: "Pesquisar por Nome",
                    paginate: { "previous": "Retorna", "next": "Avança" },
                    zeroRecords: "Nada foi encontrado",
                    info: "Exibindo página _PAGE_ de _PAGES_",
                    infoEmpty: "Sem registros",
                    infoFiltered: "(filtrado de _MAX_ regitros totais)",
                    select: {
                        rows: {
                            _: '%d linhas selecionadas',
                            0: 'Clique na linha para selecionar',
                            1: 'Apenas uma linha selecionada'
                        }
                    }
                },

        
               processing: true, // for show progress bar
                serverSide: true, // for process server side
                filter: true, // this is for disable filter (search box)
                orderMulti: true, // for disable multiple column at once
                pageLength: 10,
               ajax: {
                   url: "/Animals/LoadData",
                   type: "POST",
                  datatype: "json"
               },

                columnDefs:
                    [{
                        "targets": [2,4,5,8,9],
                        "searchable": false,
                        "orderable": false
                    }, {
                            orderable: false,
                            className: 'select-checkbox',
                            targets: 0
                        }, {
                            targets: [1,2,3,4,5,6,7],
                            render: function (data, type, row) {
                                var color = 'black';
                                if (data == "Pago") {
                                    color = 'green';
                                }
                                if (data == "Pendente") {
                                    color = 'red';
                                }
                               
                                return '<span style="color:' + color + '">' + data + '</span>';
                            }
                        }
  ],
                columns: [
                  
                    {
                        "className": 'details-control',
                        "orderable": false,
                        "data": null,
                        "defaultContent": '',
                        "render": function () {
                            return '<i class="fa fa-plus-square" aria-hidden="true"></i>';
                        },
                        width: "15px"
                    },
                    { "data": "Nome", "name": "Nome", "autoWidth": true },
                    { "data": "ClienteNome", "title": "Cliente", "autoWidth": true },
                    { "data": "Sexo", "name": "Sexo", "autoWidth": true },
                    { "data": "Tipo", "title": "Tipo de Animal", "autoWidth": true },
                    { data: "Preco", render: $.fn.dataTable.render.number(',', '.', 0, 'R$') },

                    {
                        "data": "Pagamento", "name": "Pagamento", "autoWidth": true, className: 'editable' },
                    {
                        "data": "Entrada",
                        "name": "Entrada",
                        "autoWidth": true,
                        render: function (data, type, row, meta) {
                            if (data == null) {
                                return '';
                            } else {
                                return moment(data).format("DD/MM/YYYY");
                            }
                        }
                        
                    }, {
                        "data": "Saida",
                        "name": "Saida",
                        "autoWidth": true,
                        render: function (data, type, row, meta) {
                            if (data == null) {
                                return '';
                            } else {
                                return moment(data).format("DD/MM/YYYY");
                            }
                        }
                    },

                    {"render": function (data, type, full, meta) {
                        return '<a href="@Url.Action("Edit","Animals")?id=' + full.AnimalID + '" class="btn btn-primary">Editar</a> | <a href="@Url.Action("Details", "Animals")?id=' + full.AnimalID + '" class="btn btn-info">Lista de serviços</a>';
                    }
                    },
                    {
                        data: null,
                        defaultContent: '<a href="#" class="btn btn-danger remove">Deletar</a>',
                        orderable: false
                    }
                ],
               select: true,
               select: {
                   style: 'multi',
                   selector: 'td:not(:first-child)'
               },
               order: [[1, 'asc']],
                buttons: [
                    { extend: "edit", editor: editor },
                    { extend: "remove", editor: editor },

                ]
           });
            $('#demoGrid tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child(format(row.data())).show();
                    tr.addClass('shown');
                }
            });
            $('#demoGrid').on('click', 'a.remove', function (e) {
                editor
                    .title('Delete row')
                    .message('Are you sure you wish to delete this row?')
                    .buttons({ "label": "Delete", "fn": function () { editor.submit() } })
                    .remove($(this).closest('tr'));
            });

            //$('#demoGrid tbody').on('click', 'tr', function () {
            //    $(this).toggleClass('selected');
            //});

            //$('#button').click(function () {
            //    alert(table.rows('.selected').data().length + ' row(s) selected');
            //});
            //$('#demoGrid tbody').on('click', 'td', function () {
            //    var cell = table.cell(this);
            //    cell.data(cell.data() + 1).draw();
            //    // note - call draw() to update the table's draw state with the new data
            //});


        });

        //$('#demoGrid Nome').on('click', 'td', function () {
        //    alert(table.cell(this).data());
        //});



        //$('#demoGrid tbody').on('click', 'td', function () {
        //    var cell = table.cell(this);
        //    cell.data(cell.data() + 1).draw();
        //    // note - call draw() to update the table's draw state with the new data
        //});




    function DeleteData(AnimalID) {
        if (confirm("Tem certeza que quer deletar este cadastro? ")) {
            Delete(AnimalID);
        }
        else {
            return false;
        }
    }
        function Delete(AnimalID) {
        var url = '@Url.Content("~/")' + "Animals/DeleteCustomer";
            $.post(url, { ID: AnimalID }, function (data) {
            if (data == "Deleted") {
                alert("Cadastro Deletado!");
                oTable = $('#demoGrid').DataTable();
                oTable.draw();
            }
            else {
                alert("Algo deu Errado!");
            }
        });
    }
    </script>

}
